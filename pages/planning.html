<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Planning - Papo R√©nov</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../style.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
:root{
  --primary-color:#007bff;
  --secondary-color:#212529;
  --background-light:#f4f7f9;
  --card-background:#ffffff;
  --price-accent:#28a745;
  --accent-orange:#ffc107;
  --border-light:#e9ecef;
  --shadow-color:rgba(0,0,0,.16);
  --dark-blue-logo:#0a1f44;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;
  background:var(--background-light);
  color:var(--secondary-color);
  line-height:1.6;
  min-width:320px;
}
nav ul li a.active{color:var(--primary-color);font-weight:700}

/* Masquage scroll nav */
nav ul{-ms-overflow-style:none;scrollbar-width:none;overflow-x:auto}
nav ul::-webkit-scrollbar{display:none}

/* Section */
.content-section{padding:20px 20px 40px;display:flex;flex-direction:column;align-items:center;text-align:center;position:relative}
h1{color:var(--secondary-color);margin:0 0 14px;font-weight:800;font-size:1.2rem}
h1::after{content:'';display:block;width:80px;height:4px;background:var(--primary-color);margin:18px auto 0;border-radius:2px}

/* Contenu principal */
.main-content-wrap{max-width:1200px;margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05)}
.main-content-wrap h1{text-align:center;font-size:2.5rem;color:#003366;margin-bottom:10px}
.main-content-wrap>p{text-align:center;font-size:1.1rem;color:#555;margin-bottom:30px}
.main-content-wrap h2{margin-top:40px;margin-bottom:25px;font-size:1.8rem;color:#003366;text-align:center}

/* Calendrier */
.calendar-wrap{padding:0 8px;cursor:pointer;position:relative}
.calendar-wrap iframe{width:100%;height:450px;border:1px solid #ccc;border-radius:8px;position:relative;z-index:1}
.calendar-wrap::after{
  content:"Cliquez pour R√©server une Date";
  position:absolute;inset:0;background:rgba(0,51,102,.7);color:#fff;
  font-size:1.5rem;font-weight:700;display:flex;justify-content:center;align-items:center;
  border-radius:8px;z-index:10;opacity:0;transition:opacity .3s;pointer-events:none
}
.calendar-wrap:hover::after{opacity:1}

/* Boutons SOS */
.sos-buttons{display:flex;gap:20px;margin:30px auto;flex-wrap:wrap;justify-content:center}
.sos-buttons button{flex:1;min-width:250px;padding:14px 22px;font-weight:600;font-size:1.05rem;border:0;border-radius:30px;color:#fff;cursor:pointer;transition:transform .2s,box-shadow .2s}
.sos-buttons button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.15)}
.sos-poseur{background:#d32f2f}
.sos-sav{background:#fbc02d;color:#333}
.sos-derniere-minute{background:#388e3c}

/* Formulaire r√©servation existant */
.reservation-form{display:grid;grid-template-columns:auto 1fr;gap:15px 25px;max-width:700px;margin:0 auto;padding:15px;text-align:left}
.reservation-form label{font-weight:600;color:#003366;align-self:flex-start;padding-top:5px}
.reservation-form input[type="text"],
.reservation-form input[type="email"],
.reservation-form input[type="date"],
.reservation-form textarea{padding:.6rem;border:1px solid #ccc;border-radius:6px;font-size:1rem;width:100%;box-sizing:border-box;resize:vertical}
.reservation-form textarea{grid-column:2/3}
.cta-button{grid-column:1/-1;background-color:#003366;color:#fff;padding:.75rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1.1rem;transition:background-color .3s ease;margin-top:15px}
.cta-button:hover{background-color:#00509e}
.form-info{grid-column:1/-1;font-size:.9em;color:#888;text-align:center;margin-top:-10px}

/* Modales SOS - Adaptation Responsive */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;
  align-items:center;justify-content:center;z-index:9999;
  padding:20px; /* Ajout d'un padding pour √©viter que la modale touche les bords sur mobile */
  overflow-y: auto; /* Permet le scroll dans le fond si n√©cessaire */
}
.modal.open{display:flex}
.modal-card{
  background:#fff;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,.25);
  max-width:720px; /* Reste la taille max */
  width:100%; /* S'assure que la carte utilise toute la largeur disponible jusqu'√† max-width */
  overflow:hidden;
  margin: auto; /* Centre la carte dans la modale */
}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:#003366;color:#fff}
.modal-header h3{margin:0;font-size:1.2rem}
.modal-close{background:transparent;border:0;color:#fff;font-size:1.4rem;cursor:pointer}
.modal-body{padding:18px}
.sos-form{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.sos-form .full{grid-column:1/-1}
.sos-form label{font-weight:600;font-size:.95rem;color:#003366}
.sos-form input,.sos-form textarea,.sos-form select{width:100%;padding:.6rem;border:1px solid #d7d7d7;border-radius:8px;font-size:1rem}
.partner-list{display:grid;grid-template-columns:1fr 1fr;gap:8px;border:1px solid #eee;padding:10px;border-radius:8px;max-height:160px;overflow:auto}
.partner-item{display:flex;gap:8px;align-items:center}
.badge{display:inline-block;background:#eef5ff;color:#003366;padding:2px 8px;border-radius:999px;font-size:.8rem;font-weight:600}
.btn-primary{background:#003366;color:#fff;border:none;border-radius:10px;padding:.8rem 1rem;font-weight:700;cursor:pointer}
.btn-primary:hover{filter:brightness(1.05)}
.help{font-size:.86rem;color:#666}

/* Footer */
footer{text-align:center;padding:20px 1rem;background-color:#003366;color:#fff;font-size:.9rem;margin-top:40px}

/* Responsive */
@media (max-width:900px){
  header nav ul{gap:1rem;justify-content:center;margin-top:10px}
  header{flex-direction:column;text-align:center}
}
@media (max-width:768px){
  .reservation-form{grid-template-columns:1fr;gap:10px;padding:0}
  .reservation-form label{grid-column:1/-1;padding-top:0}
  .reservation-form input,.reservation-form textarea{grid-column:1/-1}
  .calendar-wrap iframe{height:350px}
  .sos-buttons button{min-width:unset;width:100%;max-width:350px}
  .sos-form{grid-template-columns:1fr}
  .partner-list{grid-template-columns:1fr}
  /* Ajustement de la modale pour les petits √©crans */
  .modal-card{
    border-radius: 0; /* Plus esth√©tique sur mobile */
    min-height: 100vh; /* Permet √† la modale de prendre toute la hauteur */
    margin: 0; /* Enl√®ve la marge pour coller aux bords */
    max-width: 100%;
    overflow-y: auto; /* Permet le scroll dans la modale */
  }
  .modal{
    padding: 0; /* Enl√®ve le padding du fond */
    align-items: flex-start; /* Positionne le contenu en haut pour un meilleur affichage mobile */
  }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <img src="../img/logo.png" alt="Logo Papo R√©nov" />
  </div>
<nav>
  <ul>
    <li><a href="../index.html">Accueil</a></li>
    <li><a href="devis.html">Demande de devis</a></li>
    <li><a href="realisations.html">Mes r√©alisations</a></li>
    <li><a href="tarifs.html">Tarifs</a></li>
    <li><a class="active" href="planning.html">Planning</a></li>
    <li><a href="contact.html">Contact</a></li>
    <li><a href="avis.html">Avis clients</a></li>
    <li><a href="courtage-cuisine.html">Courtage Cuisine</a></li>
  </ul>
</nav>
</header>

<main class="main-content-wrap">
  <h1>Planning</h1>
  <p>Consultez mes disponibilit√©s ci-dessous :</p>

  <div class="calendar-wrap" onclick="scrollToReservation()">
    <iframe
      src="https://calendar.google.com/calendar/embed?src=kpaporalkis.pro%40gmail.com&ctz=Europe%2FParis"
      frameborder="0" scrolling="no">
    </iframe>
  </div>

  <div class="sos-buttons">
    <button class="sos-poseur" data-modal="modal-poseur">üö® SOS POSEUR</button>
    <button class="sos-sav" data-modal="modal-sav">üõ†Ô∏è SOS SAV</button>
    <button class="sos-derniere-minute" data-modal="modal-derniere">‚ö° SOS DISPO DERNI√àRE MINUTE</button>
  </div>

  <h2 id="reservation-section">R√©server une date</h2>
  <form action="https://formspree.io/f/mpwrpypd" method="POST" class="reservation-form">
    <input type="hidden" name="_captcha" value="false" />
    <input type="hidden" name="_next" value="https://paporalkis.github.io/papo-renov/pages/confirmation.html" />

    <label for="name">Nom :</label>
    <input id="name" type="text" name="name" required />

    <label for="email">Email :</label>
    <input id="email" type="email" name="email" required />

    <label for="date">Date souhait√©e :</label>
    <input id="date" type="date" name="date" required />

    <label for="message">Message compl√©mentaire :</label>
    <textarea id="message" name="message" rows="4" placeholder="Pr√©cisez vos besoins..."></textarea>

    <button type="submit" class="cta-button">Envoyer la demande</button>
    <p class="form-info">* Vous recevrez une r√©ponse de confirmation par e-mail.</p>
  </form>
</main>

<footer>
  <p>&copy; 2025 Paporalkis - Tous droits r√©serv√©s</p>
</footer>

<div class="modal" id="modal-poseur" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="poseur-title">
    <div class="modal-header">
      <h3 id="poseur-title">üö® SOS Poseur</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-poseur" class="sos-form">
        <input type="hidden" name="type" value="SOS_POSEUR"/>
        <label>Nom complet</label>
        <input name="clientName" type="text" required />
        <label>Email</label>
        <input name="clientEmail" type="email" required />
        <label>T√©l√©phone</label>
        <input name="clientPhone" type="text" required />
        <label>Adresse chantier</label>
        <input name="clientAddress" type="text" class="full" placeholder="N¬∞, rue, ville" />
        <label>Dates souhait√©es (d√©but)</label>
        <input name="dateStart" type="date" required />
        <label>Dates souhait√©es (fin)</label>
        <input name="dateEnd" type="date" />
        <label class="full">Description de la demande</label>
        <textarea name="description" rows="4" class="full" required></textarea>

        <div class="full">
          <span class="badge">S√©lection des poseurs</span>
          <div id="partnerPoseurs" class="partner-list"></div>
          <div class="help">Coche les poseurs √† notifier.</div>
        </div>

        <label class="full">Pi√®ces jointes (plans, photos)</label>
        <input name="files" type="file" class="full" multiple />

        <button class="btn-primary full" type="submit">Envoyer la demande</button>
        <div class="help full">Le premier poseur qui accepte remporte la demande. Les autres seront automatiquement bloqu√©s.</div>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="modal-sav" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="sav-title">
    <div class="modal-header">
      <h3 id="sav-title">üõ†Ô∏è SOS SAV</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-sav" class="sos-form">
        <input type="hidden" name="type" value="SOS_SAV"/>
        <label>Nom complet</label>
        <input name="clientName" type="text" required />
        <label>Email</label>
        <input name="clientEmail" type="email" required />
        <label>T√©l√©phone</label>
        <input name="clientPhone" type="text" required />
        <label>Adresse intervention</label>
        <input name="clientAddress" type="text" class="full" placeholder="N¬∞, rue, ville" />
        <label>Date souhait√©e</label>
        <input name="dateStart" type="date" required />
        <label>‚Äî</label><div></div>
        <label class="full">Description du SAV</label>
        <textarea name="description" rows="4" class="full" required></textarea>

        <div class="full">
          <span class="badge">S√©lection des poseurs</span>
          <div id="partnerSAV" class="partner-list"></div>
          <div class="help">Coche les poseurs √† notifier.</div>
        </div>

        <label class="full">Pi√®ces jointes</label>
        <input name="files" type="file" class="full" multiple />

        <button class="btn-primary full" type="submit">Envoyer la demande</button>
        <div class="help full">Le premier poseur qui accepte remporte la demande. Les autres seront automatiquement bloqu√©s.</div>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="modal-derniere" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="derniere-title">
    <div class="modal-header">
      <h3 id="derniere-title">‚ö° SOS Dispo Derni√®re Minute</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-derniere" class="sos-form">
        <input type="hidden" name="type" value="SOS_DERNIERE_MINUTE"/>
        <label>Nom du poseur</label>
        <input name="fitterName" type="text" required />
        <label>Email du poseur</label>
        <input name="fitterEmail" type="email" required />
        <label>T√©l√©phone du poseur</label>
        <input name="fitterPhone" type="text" required />
        <label>Date de disponibilit√©</label>
        <input name="availableDate" type="date" required />
        <label>Zone d‚Äôintervention</label>
        <input name="area" type="text" />

        <label class="full">Description (comp√©tences, cr√©neau, etc.)</label>
        <textarea name="description" rows="4" class="full" required></textarea>

        <div class="full">
          <span class="badge">S√©lection des magasins</span>
          <div id="partnerStores" class="partner-list"></div>
          <div class="help">Coche les magasins √† notifier.</div>
        </div>

        <label class="full">Pi√®ces jointes (photos, assurances, etc.)</label>
        <input name="files" type="file" class="full" multiple />

        <button class="btn-primary full" type="submit">Notifier les magasins</button>
        <div class="help full">Le premier magasin qui accepte confirme la mission. Les autres seront automatiquement bloqu√©s.</div>
      </form>
    </div>
  </div>
</div>
<script>
  function scrollToReservation(){
    const reservationSection=document.getElementById('reservation-section');
    if(reservationSection){reservationSection.scrollIntoView({behavior:'smooth',block:'start'});}
  }

  // ‚úÖ URL du Web App (guillemets droits, 1 seule ligne)
  const SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyDaxItj7apWyLqdGdyZU4OJktybuYtRhV_-m0TFMFtISnJvT-Syr38t7P26kzU1UBQ/exec';

  // Listes partenaires (√† compl√©ter avec tes vrais contacts)
  const PARTNERS_POSEURS = [
    {name:'Poseur A', email:'poseurA@example.com'},
    {name:'Poseur B', email:'poseurB@example.com'}
  ];
  const PARTNERS_SAV = [
    {name:'Poseur SAV 1', email:'sav1@example.com'},
    {name:'Poseur SAV 2', email:'sav2@example.com'}
  ];
  const PARTNERS_STORES = [
    {name:'Magasin X', email:'magasinX@example.com'},
    {name:'Magasin Y', email:'magasinY@example.com'}
  ];

  /* ===== UI Modales ===== */
  document.querySelectorAll('.sos-buttons button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id=btn.getAttribute('data-modal');
      const modal=document.getElementById(id);
      if(modal){modal.classList.add('open');}
    });
  });
  document.querySelectorAll('[data-close]').forEach(x=>{
    x.addEventListener('click',()=>x.closest('.modal').classList.remove('open'));
  });
  document.querySelectorAll('.modal').forEach(m=>{
    m.addEventListener('click',e=>{
      if(e.target===m){m.classList.remove('open');}
    });
  });

  // Alimente les listes de partenaires
  function renderPartners(containerId, list){
    const box=document.getElementById(containerId);
    if(!box) return;
    box.innerHTML='';
    list.forEach((p,i)=>{
      const id=containerId+'_p_'+i;
      const item=document.createElement('label');
      item.className='partner-item';
      item.innerHTML=`
        <input type="checkbox" value="${p.email}" data-name="${p.name}" id="${id}">
        <span>${p.name}</span>
        <span class="badge">${p.email}</span>
      `;
      box.appendChild(item);
    });
  }
  renderPartners('partnerPoseurs', PARTNERS_POSEURS);
  renderPartners('partnerSAV', PARTNERS_SAV);
  renderPartners('partnerStores', PARTNERS_STORES);

  /* ===== Envoi des 3 formulaires vers Google Apps Script ===== */
  function uuid(){
    if(window.crypto?.randomUUID) return crypto.randomUUID();
    return 'req-'+Math.random().toString(36).slice(2)+Date.now();
  }

  async function submitSosForm(form, partnerContainerId){
    const reqId = uuid();
    const fd = new FormData(form);
    fd.append('action','createRequest');
    fd.append('requestId', reqId);

    // Partenaires coch√©s
    const selected = Array.from(document.querySelectorAll('#'+partnerContainerId+' input[type="checkbox"]:checked'))
      .map(c=>({email:c.value, name:c.dataset.name}));
    if(selected.length===0){
      alert('S√©lectionne au moins un partenaire.');
      return;
    }
    fd.append('recipients', JSON.stringify(selected));

    try{
      const res = await fetch(SCRIPT_WEB_APP_URL, {method:'POST', body:fd});
      const data = await res.json();
      if(data.status==='OK'){
        alert('Demande envoy√©e. Un e-mail avec liens Accepter/Refuser a √©t√© transmis aux partenaires s√©lectionn√©s.');
        form.reset();
        document.querySelectorAll('#'+partnerContainerId+' input[type="checkbox"]').forEach(c=>c.checked=false);
        document.querySelectorAll('.modal.open').forEach(m=>m.classList.remove('open'));
      }else{
        console.error(data);
        alert('Erreur serveur: '+(data.message||'inconnue'));
      }
    }catch(e){
      console.error(e);
      alert('Impossible de contacter le serveur. V√©rifie l‚ÄôURL du script et les autorisations.');
    }
  }

  document.getElementById('form-poseur').addEventListener('submit', e=>{
    e.preventDefault();
    submitSosForm(e.target, 'partnerPoseurs');
  });
  document.getElementById('form-sav').addEventListener('submit', e=>{
    e.preventDefault();
    submitSosForm(e.target, 'partnerSAV');
  });
  document.getElementById('form-derniere').addEventListener('submit', e=>{
    e.preventDefault();
    submitSosForm(e.target, 'partnerStores');
  });
</script>

</body>
</html>
