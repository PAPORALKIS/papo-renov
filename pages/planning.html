<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Planning - Papo R√©nov</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../style.css">
<link rel="preconnect" href="https://cdnjs.cloudflare.com">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
:root{
  --primary-color:#007bff;
  --secondary-color:#212529;
  --background-light:#f4f7f9;
  --card-background:#ffffff;
  --price-accent:#28a745;
  --accent-orange:#ffc107;
  --border-light:#e9ecef;
  --shadow-color:rgba(0,0,0,.16);
  --dark-blue-logo:#0a1f44;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;
  background:var(--background-light);
  color:var(--secondary-color);
  line-height:1.6;
  min-width:320px;
}
nav ul li a.active{color:var(--primary-color);font-weight:700}
nav ul{-ms-overflow-style:none;scrollbar-width:none;overflow-x:auto}
nav ul::-webkit-scrollbar{display:none}

/* Structure principale */
.main-content-wrap{max-width:1200px;margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05)}
.main-content-wrap h1{text-align:center;font-size:2rem;color:#003366;margin-bottom:6px}
.main-content-wrap>p{text-align:center;font-size:1.1rem;color:#555;margin-bottom:30px}
.main-content-wrap h2{margin-top:40px;margin-bottom:25px;font-size:1.8rem;color:#003366;text-align:center}

/* Calendrier */
.calendar-wrap{padding:0 8px;cursor:pointer;position:relative}
.calendar-wrap iframe{width:100%;height:450px;border:1px solid #ccc;border-radius:8px}
.calendar-wrap::after{
  content:"Cliquez pour R√©server une Date";
  position:absolute;inset:0;background:rgba(0,51,102,.7);color:#fff;
  font-size:1.5rem;font-weight:700;display:flex;justify-content:center;align-items:center;
  border-radius:8px;z-index:10;opacity:0;transition:opacity .3s;pointer-events:none
}
.calendar-wrap:hover::after{opacity:1}

/* Boutons SOS */
.sos-buttons{display:flex;gap:20px;margin:30px auto;flex-wrap:wrap;justify-content:center}
.sos-buttons button{flex:1;min-width:250px;padding:14px 22px;font-weight:600;font-size:1.05rem;border:0;border-radius:30px;color:#fff;cursor:pointer;transition:transform .2s,box-shadow .2s}
.sos-buttons button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.15)}
.sos-poseur{background:#d32f2f}
.sos-sav{background:#fbc02d;color:#333}
.sos-derniere-minute{background:#388e3c}

/* Formulaire r√©servation */
.reservation-form{display:grid;grid-template-columns:auto 1fr;gap:15px 25px;max-width:700px;margin:0 auto;padding:15px;text-align:left}
.reservation-form label{font-weight:600;color:#003366}
.reservation-form input[type="text"],.reservation-form input[type="email"],.reservation-form input[type="date"],.reservation-form textarea{
  padding:.6rem;border:1px solid #ccc;border-radius:6px;font-size:1rem;width:100%;resize:vertical}
.cta-button{grid-column:1/-1;background-color:#003366;color:#fff;padding:.75rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1.1rem;transition:background-color .3s;margin-top:15px}
.cta-button:hover{background-color:#00509e}
.form-info{grid-column:1/-1;font-size:.9em;color:#888;text-align:center;margin-top:-10px}

/* ===== MODALES ‚Äî Full responsive ===== */
:root { --modal-gap: 20px; }

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: var(--modal-gap);
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--modal-gap));
  overflow: hidden;
}
.modal.open { display: flex; animation: fadeIn .25s ease both; }

.modal-card {
  background:#fff;
  border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  width: min(96vw, 720px);
  max-width:720px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  transform:scale(.98);
  opacity:0;
  animation: zoomIn .28s ease both;
  max-height: calc(100dvh - (var(--modal-gap) * 2));
}
@supports not (height: 100dvh) {
  .modal-card { max-height: calc(100vh - (var(--modal-gap) * 2)); }
}

.modal-header{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:#003366;color:#fff}
.modal-header h3{margin:0;font-size:1.15rem}
.modal-close{background:transparent;border:0;color:#fff;font-size:1.5rem;cursor:pointer;padding:0 5px}
.modal-body{flex:1 1 auto;overflow:auto;padding:18px;-webkit-overflow-scrolling:touch;scrollbar-width:thin}

.sos-form{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.sos-form .full{grid-column:1/-1}
.sos-form label{font-weight:600;font-size:.95rem;color:#003366}
.sos-form input,.sos-form textarea,.sos-form select{width:100%;padding:.6rem;border:1px solid #d7d7d7;border-radius:8px;font-size:1rem}

@keyframes fadeIn { from{opacity:0} to{opacity:1} }
@keyframes zoomIn { from{transform:scale(.98);opacity:0} to{transform:scale(1);opacity:1} }

@media (orientation: landscape) and (max-height: 500px) {
  .modal-card { max-height: calc(100dvh - (var(--modal-gap) * 2)); }
  .modal-body { padding: 12px; }
  .sos-form { gap: 10px; }
}

@media (max-width: 768px){
  .modal-card{ width: min(96vw, 640px); border-radius:12px; }
  .modal-body{ padding:16px; }
  .sos-form{ grid-template-columns:1fr; gap:10px; }
  .modal-header h3{ font-size:1rem; }
}

html.modal-lock, html.modal-lock body { overflow: hidden; }

/* Footer */
footer{text-align:center;padding:20px 1rem;background-color:#003366;color:#fff;font-size:.9rem;margin-top:40px}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="../img/logo.png" alt="Logo Papo R√©nov" /></div>
  <nav>
    <ul>
      <li><a href="../index.html">Accueil</a></li>
      <li><a href="devis.html">Demande de devis</a></li>
      <li><a href="realisations.html">Mes r√©alisations</a></li>
      <li><a href="tarifs.html">Tarifs</a></li>
      <li><a class="active" href="planning.html">Planning</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="avis.html">Avis clients</a></li>
      <li><a href="courtage-cuisine.html">Courtage Cuisine</a></li>
    </ul>
  </nav>
</header>

<main class="main-content-wrap">
  <h1>Planning</h1>

   <div class="sos-buttons">
    <button class="sos-poseur" data-modal="modal-poseur">üö® SOS POSEUR</button>
    <button class="sos-sav" data-modal="modal-sav">üõ†Ô∏è SOS SAV</button>
    <button class="sos-derniere-minute" data-modal="modal-derniere">‚ö° SOS DISPO DERNI√àRE MINUTE</button>
  </div>
  
  <p>Consultez mes disponibilit√©s ci-dessous :</p>

  <div class="calendar-wrap" onclick="scrollToReservation()">
    <iframe src="https://calendar.google.com/calendar/embed?src=kpaporalkis.pro%40gmail.com&ctz=Europe%2FParis" frameborder="0" scrolling="no"></iframe>
  </div>



  <h2 id="reservation-section">R√©server une date</h2>
  <form action="https://formspree.io/f/mpwrpypd" method="POST" class="reservation-form">
    <input type="hidden" name="_captcha" value="false" />
    <input type="hidden" name="_next" value="https://paporalkis.github.io/papo-renov/pages/confirmation.html" />
    <label for="name">Nom :</label>
    <input id="name" type="text" name="name" required />
    <label for="email">Email :</label>
    <input id="email" type="email" name="email" required />
    <label for="dateStart">Date souhait√©e ‚Äî Du :</label>
<input id="dateStart" type="date" name="dateStart" required />

<label for="dateEnd">Date souhait√©e ‚Äî Au :</label>
<input id="dateEnd" type="date" name="dateEnd" required />
    <label for="message">Message compl√©mentaire :</label>
    <textarea id="message" name="message" rows="4" placeholder="Pr√©cisez vos besoins..."></textarea>
    <button type="submit" class="cta-button">Envoyer la demande</button>
    <p class="form-info">* Vous recevrez une r√©ponse de confirmation par e-mail.</p>
  </form>
</main>

<footer><p>&copy; 2025 Paporalkis - Tous droits r√©serv√©s</p></footer>

<!-- ====== MODALES ====== -->
<div class="modal" id="modal-poseur">
  <div class="modal-card">
    <div class="modal-header">
      <h3>üö® SOS Poseur</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-poseur" class="sos-form">
        <input type="hidden" name="type" value="SOS_POSEUR"/>
        <label>Nom complet</label><input name="clientName" type="text" required />
        <label>Email</label><input name="clientEmail" type="email" required />
        <label>T√©l√©phone</label><input name="clientPhone" type="text" required />
        <label>Adresse chantier</label><input name="clientAddress" type="text" class="full" />
        <label>Dates souhait√©es (d√©but)</label><input name="dateStart" type="date" required />
        <label>Dates souhait√©es (fin)</label><input name="dateEnd" type="date" />
        <label class="full">Description de la demande</label><textarea name="description" rows="4" class="full" required></textarea>
        <label class="full">Pi√®ces jointes</label><input name="files" type="file" class="full" multiple />
        <button class="btn-primary full" type="submit">Envoyer la demande</button>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="modal-sav">
  <div class="modal-card">
    <div class="modal-header">
      <h3>üõ†Ô∏è SOS SAV</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-sav" class="sos-form">
        <input type="hidden" name="type" value="SOS_SAV"/>
        <label>Nom complet</label><input name="clientName" type="text" required />
        <label>Email</label><input name="clientEmail" type="email" required />
        <label>T√©l√©phone</label><input name="clientPhone" type="text" required />
        <label>Adresse intervention</label><input name="clientAddress" type="text" class="full" />
        <label>Date souhait√©e</label><input name="dateStart" type="date" required />
        <label class="full">Description du SAV</label><textarea name="description" rows="4" class="full" required></textarea>
        <label class="full">Pi√®ces jointes</label><input name="files" type="file" class="full" multiple />
        <button class="btn-primary full" type="submit">Envoyer la demande</button>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="modal-derniere">
  <div class="modal-card">
    <div class="modal-header">
      <h3>‚ö° SOS Dispo Derni√®re Minute</h3>
      <button class="modal-close" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-derniere" class="sos-form">
        <input type="hidden" name="type" value="SOS_DERNIERE_MINUTE"/>
        <label>Nom du poseur</label><input name="fitterName" type="text" required />
        <label>Email du poseur</label><input name="fitterEmail" type="email" required />
        <label>T√©l√©phone du poseur</label><input name="fitterPhone" type="text" required />
        <label>Date de disponibilit√©</label><input name="availableDate" type="date" required />
        <label>Zone d‚Äôintervention</label><input name="area" type="text" />
        <label class="full">Description</label><textarea name="description" rows="4" class="full" required></textarea>
        <label class="full">Pi√®ces jointes</label><input name="files" type="file" class="full" multiple />
        <button class="btn-primary full" type="submit">Notifier les magasins</button>
      </form>
    </div>
  </div>
</div>
<!-- ====== FIN MODALES ====== -->

<script>
function scrollToReservation(){document.getElementById('reservation-section')?.scrollIntoView({behavior:'smooth'});}

const SCRIPT_WEB_APP_URL='https://script.google.com/macros/s/AKfycbwuOtAKC5KEJYwKKRsIj2GLlP7Fy9bhVTjhjPWKMyzgejbanj9Fdmqyln4NEyneoHI/exec';
const PARTNERS_POSEURS=[{name:'Poseur A',email:'poseurA@example.com'},{name:'Poseur B',email:'poseurB@example.com'}];
const PARTNERS_SAV=[{name:'Poseur SAV 1',email:'sav1@example.com'},{name:'Poseur SAV 2',email:'sav2@example.com'}];
const PARTNERS_STORES=[{name:'Magasin X',email:'magasinX@example.com'},{name:'Magasin Y',email:'magasinY@example.com'}];

function setModalLock(on){document.documentElement.classList.toggle('modal-lock',!!on);}
function recomputeModalHeights(){
  document.querySelectorAll('.modal-card').forEach(card=>{
    card.style.maxHeight=`calc(${window.innerHeight}px - (var(--modal-gap) * 2))`;
    requestAnimationFrame(()=>{card.style.maxHeight='';});
  });
}
addEventListener('resize',recomputeModalHeights);
addEventListener('orientationchange',recomputeModalHeights);

document.querySelectorAll('.sos-buttons button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id=btn.dataset.modal, modal=document.getElementById(id);
    if(modal){modal.classList.add('open');setModalLock(true);recomputeModalHeights();}
  });
});
document.querySelectorAll('[data-close]').forEach(x=>{
  x.addEventListener('click',()=>{
    x.closest('.modal').classList.remove('open');
    if(!document.querySelector('.modal.open'))setModalLock(false);
  });
});
document.querySelectorAll('.modal').forEach(m=>{
  m.addEventListener('click',e=>{
    if(e.target===m){
      m.classList.remove('open');
      if(!document.querySelector('.modal.open'))setModalLock(false);
    }
  });
});

function uuid(){return(window.crypto?.randomUUID)?crypto.randomUUID():'req-'+Math.random().toString(36).slice(2)+Date.now();}

async function submitSosForm(form,partnerList){
  const fd=new FormData(form);
  fd.append('action','createRequest');
  fd.append('requestId',uuid());
  fd.append('recipients',JSON.stringify(partnerList));
  try{
    const res=await fetch(SCRIPT_WEB_APP_URL,{method:'POST',body:fd});
    const data=await res.json();
    if(data.status==='OK'){
      alert('Demande envoy√©e √† tous les partenaires. Le premier qui accepte remporte la demande.');
      form.reset();
      document.querySelectorAll('.modal.open').forEach(m=>m.classList.remove('open'));
      setModalLock(false);
    }else{
      console.error(data);
      alert('Erreur serveur: '+(data.message||'inconnue'));
    }
  }catch(e){
    console.error(e);
    alert('Impossible de contacter le serveur. V√©rifie l‚ÄôURL du script et les autorisations.');
  }
}

document.getElementById('form-poseur').addEventListener('submit',e=>{
  e.preventDefault(); submitSosForm(e.target,PARTNERS_POSEURS);
});
document.getElementById('form-sav').addEventListener('submit',e=>{
  e.preventDefault(); submitSosForm(e.target,PARTNERS_SAV);
});
document.getElementById('form-derniere').addEventListener('submit',e=>{
  e.preventDefault(); submitSosForm(e.target,PARTNERS_STORES);
});
</script>

</body>
</html>
