<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Courtage Cuisine - Papo Rénov</title>
  <style>
    :root {
      --brand: #003366;
      --accent: #007bff;
      --bg: #f9f9f9;
      --radius: 12px;
    }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: var(--bg);
      color: #333;
      line-height: 1.6;
    }
    header {
      background-color: var(--brand);
      color: #fff;
      text-align: center;
      padding: 1.5rem 1rem;
    }
    header img {
      height: 80px;
      margin-bottom: 10px;
    }
    h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    main {
      padding: 1.5rem;
      max-width: 800px;
      margin: 0 auto;
    }
    section {
      background: #fff;
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    h2 {
      text-align: center;
      color: var(--brand);
      margin-bottom: 1rem;
    }
    p {
      margin-bottom: 1rem;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    label {
      font-weight: 500;
    }
    input, textarea, select {
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      width: 100%;
    }
    button {
      background: var(--brand);
      color: #fff;
      border: none;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: var(--accent);
    }
    .form-info {
      text-align: center;
      font-size: 0.9rem;
      color: #666;
    }
    footer {
      background: var(--brand);
      color: #fff;
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <img src="../img/logo.png" alt="Logo Papo Rénov">
    <h1>Courtage Cuisine - Brief Gratuit</h1>
  </header>

  <main>
    <section>
      <h2>Remplissez votre brief</h2>
      <p>Décrivez votre projet pour recevoir gratuitement une estimation de votre future cuisine.</p>

      <form id="briefForm" action="https://script.google.com/macros/s/AKfycbyY9QTebInuAsjEJfarmHyynbfglApRZcEdLp-T3eUHb3dc6mjILc08oQxuCElWUJpWdA/exec" method="POST">
        <label for="nom">Nom complet *</label>
        <input type="text" id="nom" name="nom" required>

        <label for="email">Adresse e-mail *</label>
        <input type="email" id="email" name="email" required>

        <label for="telephone">Téléphone</label>
        <input type="tel" id="telephone" name="telephone">

        <label for="ville">Ville</label>
        <input type="text" id="ville" name="ville">

        <label for="description">Décrivez votre projet :</label>
        <textarea id="description" name="description" rows="5"></textarea>

        <label>
          <input type="checkbox" id="cond" required>
          J’ai compris que le brief gratuit est conditionné à la pose effectuée par un partenaire Papo Rénov.
        </label>

        <button type="submit">Recevoir mon estimation</button>
        <div id="formMsg" class="form-info"></div>
      </form>
    </section>
  </main>

  <footer>
    © 2025 Papo Rénov - Courtage Cuisine. Tous droits réservés.
  </footer>

  <!-- ✅ Nouveau script avec redirection locale vers Merci.html -->
  <script>
  // Accessibilité focus visible
  (function(){document.addEventListener('keydown',e=>{if(e.key==='Tab'){document.body.classList.add('kbd')}})})();

  // --------- SOUMISSION BRIEF : fetch + redirection locale ---------
  const form = document.getElementById('briefForm');
  const formMsg = document.getElementById('formMsg');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Validation minimale
    const nom = document.getElementById('nom').value.trim();
    const email = document.getElementById('email').value.trim();
    const cond = document.getElementById('cond').checked;
    if (!nom || !email || !cond) {
      formMsg.textContent = "Merci de compléter les champs requis et d’accepter la condition de gratuité liée à la pose.";
      formMsg.style.color = "#b42318";
      return;
    }

    // Feedback visuel
    formMsg.textContent = "Traitement en cours, veuillez patienter...";
    formMsg.style.color = "var(--brand)";
    const submitBtn = form.querySelector('button[type="submit"]');
    const prevTxt = submitBtn?.textContent;
    if (submitBtn){ submitBtn.disabled = true; submitBtn.textContent = "Envoi…"; }

    // Envoi vers Apps Script
    const redirectUrl = "Merci.html";
    const fd = new FormData(form);

    try {
      const ctrl = new AbortController();
      const tm = setTimeout(() => ctrl.abort(), 8000);
      await fetch(form.action, { method: "POST", body: fd, signal: ctrl.signal });
      clearTimeout(tm);
      window.location.href = redirectUrl;
    } catch (err) {
      window.location.href = redirectUrl;
    } finally {
      if (submitBtn){ submitBtn.disabled = false; submitBtn.textContent = prevTxt || "Recevoir mon estimation"; }
    }
  });

  // Défilement fluide ancres
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click',e=>{
      const id=a.getAttribute('href');
      if(id.length>1){
        e.preventDefault();
        document.querySelector(id)?.scrollIntoView({behavior:'smooth',block:'start'});
      }
    });
  });
  </script>
</body>
</html>
