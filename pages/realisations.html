<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rotation Interactive</title>
<style>
  body {
    margin: 0; 
    overflow: hidden; 
    background: #222;
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh;
    color: white;
    font-family: Arial, sans-serif;
  }
  #container {
    position: relative;
    width: 80vw;
    height: 60vh;
    perspective: 1000px;
    user-select: none;
    overflow: visible;
  }
  .item {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-style: preserve-3d;
    transition: transform 0.3s ease;
    cursor: grab;
  }
  .item img {
    display: block;
    width: 100px;
    height: 100px;
    border-radius: 10px;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
  }
  .item:active {
    cursor: grabbing;
  }
</style>
</head>
<body>

<div id="container">
  <!-- Quelques images exemples -->
  <div class="item"><img src="https://picsum.photos/id/1011/100/100" alt="Image 1" /></div>
  <div class="item"><img src="https://picsum.photos/id/1015/100/100" alt="Image 2" /></div>
  <div class="item"><img src="https://picsum.photos/id/1016/100/100" alt="Image 3" /></div>
  <div class="item"><img src="https://picsum.photos/id/1018/100/100" alt="Image 4" /></div>
  <div class="item"><img src="https://picsum.photos/id/1020/100/100" alt="Image 5" /></div>
  <div class="item"><img src="https://picsum.photos/id/1024/100/100" alt="Image 6" /></div>
</div>

<script>
  const container = document.getElementById("container");
  const items = [...container.getElementsByClassName("item")];
  let angle = 0;
  let velocity = 0.02;
  let autoRotate = true;
  let isDragging = false;
  let lastX = 0;
  let interactionTimeout;

  // Mise à jour styles container (ex: taille, etc.)
  function updateContainerStyle() {
    // Pour l’exemple, pas de changement dynamique
  }

  // Mise à jour des tailles des images (si besoin)
  function updateImageSizes() {
    // Pas nécessaire ici, fixe à 100x100 px
  }

  // Positionne les images en cercle 3D
  function positionImages() {
    const radius = Math.min(container.clientWidth, container.clientHeight) / 2.5;
    const centerX = container.clientWidth / 2;
    const centerY = container.clientHeight / 2;
    const count = items.length;
    const slice = (2 * Math.PI) / count;

    items.forEach((item, i) => {
      const itemAngle = slice * i + angle;
      const x = centerX + radius * Math.cos(itemAngle) - item.clientWidth / 2;
      const y = centerY + radius * Math.sin(itemAngle) - item.clientHeight / 2;

      item.style.transform = `translate3d(${x}px, ${y}px, 0)`;
      // Si tu veux effet profondeur : modifie z-index selon y, ou scale
      // Exemple : item.style.zIndex = Math.round(1000 + 1000 * Math.sin(itemAngle));
    });
  }

  // Animation boucle
  function animate() {
    if (autoRotate && !isDragging) {
      angle += velocity;
    } else {
      // On peut ralentir la vitesse progressivement pour un effet inertia
      velocity *= 0.95;
      if (Math.abs(velocity) < 0.001) velocity = 0;
      angle += velocity;
    }
    positionImages();
    requestAnimationFrame(animate);
  }

  function restartAutoRotate() {
    clearTimeout(interactionTimeout);
    interactionTimeout = setTimeout(() => {
      autoRotate = true;
      velocity = 0.02;
    }, 2000);
  }

  function onDragStart(x) {
    isDragging = true;
    lastX = x;
    autoRotate = false;
    velocity = 0;
  }

  function onDragMove(x) {
    if (!isDragging) return;
    const dx = x - lastX;
    velocity = dx * 0.005;  // facteur réduit pour moins de sensibilité
    angle += velocity;
    lastX = x;
  }

  function onDragEnd() {
    if (isDragging) {
      isDragging = false;
      restartAutoRotate();
    }
  }

  // Événements souris
  container.addEventListener("mousedown", e => onDragStart(e.clientX));
  window.addEventListener("mouseup", onDragEnd);
  window.addEventListener("mousemove", e => onDragMove(e.clientX));

  // Événements tactiles
  container.addEventListener("touchstart", e => {
    if (e.touches.length === 1) onDragStart(e.touches[0].clientX);
  }, { passive: true });
  container.addEventListener("touchend", onDragEnd);
  container.addEventListener("touchmove", e => {
    if (e.touches.length === 1) {
      e.preventDefault();
      onDragMove(e.touches[0].clientX);
    }
  }, { passive: false });

  // Molette souris
  container.addEventListener("wheel", e => {
    e.preventDefault();
    autoRotate = false;
    velocity += e.deltaY * 0.0005; // sensibilité plus faible
    restartAutoRotate();
  }, { passive: false });

  // Responsive
  window.addEventListener('resize', () => {
    updateContainerStyle();
    updateImageSizes();
    positionImages();
  });

  // Initialisation
  updateContainerStyle();
  updateImageSizes();
  positionImages();
  requestAnimationFrame(animate);

</script>

</body>
</html>
